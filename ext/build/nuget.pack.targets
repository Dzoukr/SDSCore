<?xml version="1.0" encoding="utf-8"?> 
<Project ToolsVersion="12.0" DefaultTargets="Pack" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <SolutionDir Condition=" '$(SolutionDir)' == '' ">.\</SolutionDir>
    <SolutionDir Condition=" '$(SolutionDir)' == '*Undefined*' ">.\</SolutionDir>
    <NugetLocation Condition="'$(NugetLocation)'==''">$(SolutionDir)ext\nuget-commandline\</NugetLocation>
    <Nuget Condition="'$(Nuget)'==''">$(NugetLocation)nuget.exe-2.8.3\nuget.exe</Nuget>
    <NugetOutput>$(SolutionDir)publish\$(Configuration)\</NugetOutput>
    <VisualStudioVersion Condition="'$(VisualStudioVersion)' == ''">12.0</VisualStudioVersion>
  </PropertyGroup>

  <Target Name="Pack" DependsOnTargets="Build">
    <Warning Text="Output path is undefined. Define OutDir" Condition="'$(OutDir)'==''"/>
    <ItemGroup>
      <NuspecFile Include="package.nuspec" />
    </ItemGroup>
    <Error Text="File package.nuspec not found" Condition="'@(NuspecFile)'==''" />
    <Copy SourceFiles="@(NuspecFile)" DestinationFolder="$(OutDir)" />
    <Exec Command="&quot;$(Nuget)&quot; pack &quot;@(NuspecFile)&quot; -Prop VisualStudioVersion=$(VisualStudioVersion) -Prop Configuration=$(Configuration) -Prop Platform=$(Platform)" IgnoreExitCode="false" 
          WorkingDirectory="$(OutDir)" />

    <MakeDir Condition="!Exists('$(NugetOutput)')" Directories="$(NugetOutput)" />
    <ItemGroup>
      <NupkgFiles Include="$(OutDir)*.nupkg" />
    </ItemGroup>
    <Copy SourceFiles="@(NupkgFiles)" DestinationFolder="$(NugetOutput)" />
  </Target>
  
  <Target Name="Clean">
    <ItemGroup>
      <OutputFiles Include="$(OutDir)**/*" />
      <!--<OutputFiles Include="$(NugetOutput)**/*.nupkg" />-->
    </ItemGroup>
    <Delete Files="@(OutputFiles)" />
  </Target>
</Project>
